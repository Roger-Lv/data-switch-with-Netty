# 数联网交换机参考实现
## 交换机管理接口说明
见链接：[README.management.md](data-switch%2FREADME.management.md)

## 交换机架构说明
路由系统由两层网络组成，一是路由系统本身存储的KV，是个标识网络；二是路由系统组网所需的BDO/DDO的标识网络。
我们称第一个标识网络为路由网络；第二个标识网络为组网网络。

交换系统需要配置网关(DDO )。
交换系统需要配置路由系统（DDO 1)。
交换系统需要支持自动注册。
因此，交换系统本身需要一个标识，这个标识管理于路由网络。

路由器系统的DDO管理于组网网络。
网关的DDO管理于路由网络。
交换机本身也会组成一个网，形成DDO,管理于路由网络？

方式一：将交换机的标识和交换机网络的标识通过“路由网络”存储。
代价：需要扩展一下DOAClusterClient。

<!---
方式二：将交换机的标识和交换机网络的标识通过”组网网络“存储。
    代价：需要把交换机的标识使用“组网网来分配”，而不是随机一个串。

方式三：将交换机的标识用“路由网络存储”，交换机网络的标识通过”组网网络“存储。
    代价：交换机既需要路由网络的标识，还需要组网网络的标识。

方式四：将交换机的标识用“组网网络”，交换机网络的标识通过”路由网络存储“存储。XX
-->


路由网络中有两个特殊的DOL。一个是交换机网络的DDO?
另一个是“网关”的？网关是特别的，不是全网可见的？所以网关的是独立的一个“小网”。网关的标识是一个不组网的，只提供给某个交换机的“标识解析网络”。
称之为空间组网网络。空间组网网络是每个空间有一个。不与其他空间互联。
所以网关的标识，是“空间组网网络”里的标识（即现在的IRPAdapter里管理的）。

配置项：

- 需要配置空间组网中的IRP地址(网关的），这个地址也可以用来解析和判断DO在不在这个空间里。也可以使用`DOAClusterClientFor网关`
  来向这个空间发起DOIP请求。
- 需要配置路由系统的组网网络的IRP地址（为了路由网络的），及路由系统的标识。
  用于定位。 `DOAClusterClientForRouter，路由网络的DDO标识`
- 与其他交换机的连接使用时，使用DoipClientImpl直连。
- 为了主动注册，需要知道网关的标识。
-
- 自动注册流程时，使用网关的DDO。 `DOAClusterClientForRouterBroadcast, 使用路由网络替代IRP的那个，交换网络的DDO标识`

| 配置项                     | 用况              | 配置项名称                                                   |
|-------------------------|-----------------|---------------------------------------------------------|
| 网关的标识解析系统地址             | 用于向空间转发消息       | gatewayIRPURL                                           |
| 网关的标识 （DDO/BDO）         | **用于订阅标识流**      | gatewayId                                               |
| 路由网络的标识解析系统地址           | 用于发起定位请求、注册定位信息 | routerIRPURL                                            |
| 路由网络的标识 （DDO/BDO）       | 用于发起定位请求、注册定位信息 | routerId                                                |
| 交换机网络的标识 (DOL，它的内容包括标识) | 用于自动注册过程，进行广播查询 | switchNetworkDOL                                        |
| 交换机的公钥/私钥               | 用于身份认证          | 在switchProp中。                                           |
| 交换机的基本信息                | 基本信息            | switchProp:{ip,port,name,switchId,publicKey,privateKey} |
| 空间中的标识流的ID（DP流量）        | 用于主动注册          | idStreams                                               |

| 网关的配置                   | 用况              | 配置项名称                                          |
|-------------------------|-----------------|------------------------------------------------|
| IRPURL                  |       |                          |
| DOIPURL4Switch          |    |                                    |
| DOIPURL4Client          |  |                                |
| id,privateKey,publicKey |   |   |






## 介绍

| 系统  | 标识格式   | 实现方式          | 谁发的              |
|-----|--------|---------------|------------------|
| 网关  | handle | DDO           | 空间内自己部署的一个标识解析系统 |
| 交换机 |        |               |
| 路由器 | handle | 路由器的组网网络分配的标识 |

